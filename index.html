<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Trip Map</title>
    <meta name="description" content="Interactive trip map generated from list.md and hotel.txt" />
    <meta name="theme-color" content="#020617" />

    <link rel="manifest" href="./manifest.webmanifest" />
    <link rel="icon" href="./assets/icons/icon-192.png" />
    <link rel="apple-touch-icon" href="./assets/icons/apple-touch-icon.png" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="Trip Map" />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Noto+Sans+JP:wght@400;500;700&display=swap"
      rel="stylesheet"
    />

    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>

    <style>
      :root {
        color-scheme: dark;
      }
      html,
      body {
        height: 100%;
        font-family:
          Inter,
          "Noto Sans JP",
          ui-sans-serif,
          system-ui,
          -apple-system,
          "Segoe UI",
          Roboto,
          Helvetica,
          Arial,
          "Apple Color Emoji",
          "Segoe UI Emoji";
      }

      #toast[data-clickable="true"] {
        cursor: pointer;
      }
      #toast[data-clickable="true"]:active {
        transform: scale(0.99);
      }

      .trip-sheet {
        height: 100dvh;
        transform: translate3d(0, var(--sheet-y, 0px), 0);
        transition: transform 280ms cubic-bezier(0.2, 0.85, 0.2, 1);
        will-change: transform;
      }
      .trip-sheet.is-dragging {
        transition: none;
      }
      #sheet[data-sheet-snap="full"] > div {
        border-radius: 0 !important;
      }
      .sheet-scroll {
        -webkit-overflow-scrolling: touch;
        overscroll-behavior: contain;
        padding-bottom: calc(env(safe-area-inset-bottom) + 14px);
      }
      @media (min-width: 768px) {
        .trip-sheet {
          height: 100% !important;
          transform: none !important;
          transition: none !important;
        }
        .sheet-scroll {
          padding-bottom: 0;
        }
      }
    </style>

    <style type="text/tailwindcss">
      @layer base {
        :root {
          --bg-a: 2 6 23; /* slate-950 */
        }
      }
    </style>
  </head>

  <body class="bg-slate-950 text-slate-50">
    <div class="pointer-events-none fixed inset-0 -z-10 overflow-hidden">
      <div
        class="absolute -left-32 -top-36 h-[420px] w-[420px] rounded-full bg-fuchsia-500/25 blur-3xl"
      ></div>
      <div
        class="absolute -right-32 top-16 h-[520px] w-[520px] rounded-full bg-cyan-400/18 blur-3xl"
      ></div>
      <div
        class="absolute left-1/3 top-2/3 h-[520px] w-[520px] rounded-full bg-rose-500/16 blur-3xl"
      ></div>
      <div class="absolute inset-0 bg-[radial-gradient(circle_at_top,#0b1020,transparent_60%)]"></div>
    </div>

    <div class="h-dvh w-full overflow-hidden">
      <div class="flex h-full w-full flex-col md:flex-row">
        <aside
          id="sheet"
          class="trip-sheet fixed inset-x-0 bottom-0 z-[1200] w-full overflow-hidden md:static md:z-auto md:h-full md:w-[420px] md:shrink-0 md:border-r md:border-white/10"
        >
          <div
            class="flex h-full flex-col rounded-t-3xl border border-white/10 bg-slate-950/70 backdrop-blur-xl md:rounded-none md:border-0 md:bg-slate-950/60"
          >
            <div
              id="sheetHandle"
              class="md:hidden touch-none cursor-grab select-none px-4 pt-2 pb-2 active:cursor-grabbing"
            >
              <div class="mx-auto h-1.5 w-12 rounded-full bg-white/15 ring-1 ring-white/10"></div>
            </div>

            <div id="sheetHeader" class="border-b border-white/10 px-4 py-2 md:py-4">
              <div class="flex items-center justify-between gap-3">
                <div class="min-w-0">
                  <div class="text-base font-extrabold tracking-tight md:text-xl">Trip Map</div>
                </div>
              </div>

              <div class="mt-2 flex items-center gap-2">
                <label class="flex-1">
                  <span class="sr-only">Search</span>
                  <input
                    id="search"
                    type="search"
                    placeholder="Search (name / area)…"
                    class="w-full rounded-2xl bg-white/5 px-4 py-2.5 text-sm text-white placeholder:text-slate-400 ring-1 ring-white/10 outline-none transition focus:ring-2 focus:ring-fuchsia-400/60"
                  />
                </label>
                <button
                  id="btnClearSearch"
                  type="button"
                  class="rounded-2xl bg-white/5 px-3 py-2.5 text-sm text-slate-200 ring-1 ring-white/10 transition hover:bg-white/10"
                  title="検索をクリア"
                >
                  ✕
                </button>
              </div>
            </div>

            <div class="sheet-scroll min-h-0 flex-1 overflow-auto">
              <div
                id="sheetTop"
                class="sticky top-0 z-10 border-b border-white/10 bg-slate-950/60 backdrop-blur-xl"
              >
                <div class="flex items-center gap-2 px-4 pt-3 pb-2">
                  <div class="inline-flex rounded-full bg-white/5 p-1 ring-1 ring-white/10">
                    <button
                      id="tabPlaces"
                      type="button"
                      class="rounded-full px-3 py-1.5 text-xs font-extrabold text-white transition data-[active=true]:bg-white/10"
                      data-active="true"
                    >
                      Places
                    </button>
                    <button
                      id="tabPlanner"
                      type="button"
                      class="rounded-full px-3 py-1.5 text-xs font-extrabold text-white/80 transition hover:text-white data-[active=true]:bg-white/10 data-[active=true]:text-white"
                      data-active="false"
                    >
                      Planner
                    </button>
                  </div>
                </div>

                <div id="placesHeader" class="px-4 pb-3">
                  <button
                    id="btnToggleCategories"
                    type="button"
                    class="flex w-full items-center justify-between rounded-2xl bg-white/5 px-3 py-2 text-xs font-semibold text-white ring-1 ring-white/10 transition hover:bg-white/10"
                    title="Toggle categories"
                  >
                    <span>Categories</span>
                    <span class="flex items-center gap-2">
                      <span
                        id="categorySummary"
                        class="rounded-full bg-white/10 px-2 py-0.5 text-[10px] font-bold text-slate-200 ring-1 ring-white/10"
                        >All</span
                      >
                      <span id="categoryCaret" class="text-slate-300">▾</span>
                    </span>
                  </button>
                  <div id="categoryWrap" class="mt-2 max-h-44 overflow-auto pr-1 hidden md:block">
                    <div class="grid grid-cols-2 gap-2" id="categoryChips"></div>
                  </div>
                  <div class="mt-2 text-xs text-slate-300" id="stats"></div>
                </div>

                <div id="plannerHeader" class="hidden px-4 pb-3">
                  <div class="flex items-center justify-between gap-3">
                    <div class="text-xs font-semibold text-slate-300">Days</div>
                    <div class="flex items-center gap-2">
                      <button
                        id="btnSync"
                        type="button"
                        class="rounded-full bg-white/10 px-3 py-1.5 text-xs font-semibold text-white ring-1 ring-white/10 transition hover:bg-white/15"
                        title="Trips & share with friends"
                      >
                        Trips
                      </button>
                      <button
                        id="btnDayDelete"
                        type="button"
                        class="rounded-full bg-white/5 px-3 py-1.5 text-xs font-semibold text-slate-200 ring-1 ring-white/10 transition hover:bg-white/10"
                        title="Delete active day"
                      >
                        Delete
                      </button>
                      <button
                        id="btnDayAdd"
                        type="button"
                        class="rounded-full bg-white/10 px-3 py-1.5 text-xs font-semibold text-white ring-1 ring-white/10 transition hover:bg-white/15"
                      >
                        + Day
                      </button>
                    </div>
                  </div>
                  <div class="mt-2 flex flex-wrap gap-2" id="plannerDays"></div>
                  <div class="mt-3 flex flex-wrap gap-2">
                    <button
                      id="btnPlanRoute"
                      type="button"
                      class="rounded-full bg-white/10 px-3 py-1.5 text-xs font-semibold text-white ring-1 ring-white/10 transition hover:bg-white/15"
                      title="Directions for this day"
                    >
                      Directions
                    </button>
                    <button
                      id="btnPlanFit"
                      type="button"
                      class="rounded-full bg-white/10 px-3 py-1.5 text-xs font-semibold text-white ring-1 ring-white/10 transition hover:bg-white/15"
                      title="Fit map to this day"
                    >
                      Fit
                    </button>
                    <button
                      id="btnPlanExport"
                      type="button"
                      class="rounded-full bg-white/10 px-3 py-1.5 text-xs font-semibold text-white ring-1 ring-white/10 transition hover:bg-white/15"
                      title="Export planner JSON"
                    >
                      Export
                    </button>
                    <label
                      class="cursor-pointer rounded-full bg-white/10 px-3 py-1.5 text-xs font-semibold text-white ring-1 ring-white/10 transition hover:bg-white/15"
                      title="Import planner JSON"
                    >
                      Import
                      <input id="planImport" type="file" accept="application/json" class="hidden" />
                    </label>
                    <button
                      id="btnDayClear"
                      type="button"
                      class="rounded-full bg-white/5 px-3 py-1.5 text-xs font-semibold text-slate-200 ring-1 ring-white/10 transition hover:bg-white/10"
                      title="Clear places in active day"
                    >
                      Clear
                    </button>
                  </div>
                </div>
              </div>

              <div id="panelPlaces">
                <div class="p-2" id="placeList"></div>
              </div>

              <div id="panelPlanner" class="hidden">
                <div class="p-2" id="plannerItems"></div>
              </div>
            </div>

            <div class="hidden border-t border-white/10 px-4 py-3 text-[11px] text-slate-400 md:block">
              データ更新: <span class="font-mono">node scripts/generate-places.mjs</span>
            </div>
          </div>
        </aside>

        <main class="relative min-h-0 flex-1">
          <div id="map" class="h-full w-full"></div>

          <div class="pointer-events-none absolute inset-0">
            <div class="absolute inset-x-0 top-0 h-24 bg-gradient-to-b from-slate-950/70 to-transparent">
            </div>
            <div
              class="absolute inset-x-0 bottom-0 h-24 bg-gradient-to-t from-slate-950/70 to-transparent"
            ></div>
          </div>

          <div class="pointer-events-none absolute left-1/2 top-4 z-[5000] -translate-x-1/2">
            <div
              id="toast"
              class="pointer-events-auto hidden rounded-full bg-black/50 px-4 py-2 text-xs font-semibold text-slate-100 ring-1 ring-white/10 backdrop-blur-xl"
            ></div>
          </div>
        </main>
      </div>
    </div>

    <script type="module" src="./app.js"></script>
  </body>
</html>
